<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Models — Toast Talent</title>
  <link rel="stylesheet" href="style.css" />

  <style>
    /* ---------- Page section ---------- */
    .models-hero { text-align:center; margin:40px 0 10px; }
    .models-gallery { max-width:1200px; margin:0 auto 60px; padding:0 18px; }
    .models-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:36px; }

    .model-card {
      background: var(--white);
      border-radius: 18px;
      box-shadow: 0 2px 12px #e0e0e0;
      overflow: hidden;
      text-align: center;
      transition: transform .18s, box-shadow .18s;
      cursor: pointer;
    }
    .model-card:hover { transform: translateY(-6px) scale(1.02); box-shadow:0 6px 28px #ddd; }
    .model-card img { width:100%; height:350px; object-fit:cover; display:block; }
    .model-name { padding:14px 0 16px; font-weight:700; font-size:1.05rem; color:var(--accent); }

    /* ---------- Lightbox overlay (no black) ---------- */
    .viewer {
      position: fixed; inset: 0;
      display: none; /* toggled to flex */
      align-items: center; justify-content: center;
      padding: 20px;
      background: rgba(255,255,255,0.65);       /* bright, not dark */
      backdrop-filter: blur(2.5px);             /* gentle blur */
      z-index: 200;
    }
    .viewer.open { display:flex; }

    .viewer-wrap {
      position: relative;
      width: min(1200px, 96vw);
      height: min(86vh, 900px);
      display: grid;
      grid-template-columns: 1.1fr 0.95fr;      /* image | floating card area */
      gap: 22px;
    }

    /* Left: stage + thumbs */
    .stage {
      position: relative;
      background: var(--white);
      border-radius: 16px;
      box-shadow: 0 4px 24px rgba(0,0,0,.06);
      padding: 16px 16px 90px;                  /* space for thumbnails */
      display: flex; align-items: center; justify-content: center;
    }
    .hero-img {
      max-width: 100%; max-height: 100%;
      object-fit: cover;
      border-radius: 10px;
    }

    .thumbs-row {
      position: absolute; left: 16px; right: 16px; bottom: 16px;
      display: flex; gap: 10px;
      padding: 10px 8px;
      background: rgba(255,255,255,.78);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0,0,0,.06);
      overflow-x: auto; scrollbar-width: thin;
    }
    .thumbs-row img {
      width: 70px; height: 70px; object-fit: cover;
      border-radius: 10px;
      border: 2px solid var(--white);
      box-shadow: 0 2px 10px rgba(0,0,0,.08);
      cursor: pointer;
      transition: transform .15s, border-color .15s, box-shadow .15s;
      flex: 0 0 auto;
    }
    .thumbs-row img:hover { transform: translateY(-2px); }
    .thumbs-row img.is-active { border-color: var(--accent); box-shadow: 0 4px 16px rgba(36,147,225,.28); }

    /* Right: floating card OVER the gallery */
    .floating-card {
      position: relative;                        /* so it can sit above stage visually */
      background: var(--white);
      border-radius: 18px;
      box-shadow: 0 12px 38px rgba(0,0,0,.12);
      padding: 18px;
      display: flex; flex-direction: column; gap: 14px;
    }

    .close-btn {
      position: absolute; top: 10px; right: 10px;
      width: 36px; height: 36px; border-radius: 999px;
      display: grid; place-items: center;
      border: 1px solid var(--border);
      background: var(--white);
      cursor: pointer;
    }

    .header {
      display: grid; grid-template-columns: 54px 1fr; gap: 12px; align-items: center;
      padding-bottom: 6px; border-bottom: 1px solid var(--border);
    }
    .avatar { width:54px; height:54px; border-radius: 999px; object-fit: cover; border: 2px solid var(--white); box-shadow: 0 2px 10px rgba(0,0,0,.08); }
    .title { font: 800 1.25rem/1.2 'Montserrat', Arial, sans-serif; color: var(--primary); }
    .subtitle { color:#6b6b6b; font-weight:600; font-size:.9rem; }

    .facts { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .fact {
      border: 1px solid var(--border); background:#fafafa; border-radius: 12px;
      padding: 12px 14px;
    }
    .fact label { display:block; color:#777; font-size:.84rem; margin-bottom:6px; }
    .fact div { font-weight:700; }

    .cta { display:flex; gap:10px; align-items:center; }
    .btn {
      display:inline-flex; align-items:center; justify-content:center;
      padding: 12px 16px; border-radius: 12px; border: 1px solid var(--border);
      background: #111; color: #fff; font-weight: 700; cursor: pointer;
    }
    .btn.secondary { background:#fff; color:#111; }
    .btn:disabled { opacity:.5; cursor:not-allowed; }

    .book-form { display:grid; gap:10px; margin-top: 6px; }
    .field { display:flex; flex-direction:column; gap:6px; }
    .field label { font-weight:700; font-size:.92rem; color:#333; }
    .field input {
      padding:11px 12px; border:1px solid var(--border); border-radius:10px;
      background:#f7f7f7; font-size: .98rem;
    }
    .note { color:#2e7d32; font-weight:700; font-size:.95rem; }

    /* responsive */
    @media (max-width: 980px) {
      .viewer-wrap { grid-template-columns: 1fr; height: auto; max-height: none; }
      .floating-card { order: -1; }      /* card above image on small screens */
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="nav-content">
      <a href="index.html" class="nav-logo">
        <img src="images/Toast Logo.jpeg" alt="Toast Talent Logo">
      </a>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="models.html" class="active">Models</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="contact.html">Contact</a></li>
        <li><a href="apply.html">Apply</a></li>
      </ul>
    </div>
  </nav>

  <!-- Page header -->
  <section class="models-hero">
    <h1 class="rainbow-models">Our Models</h1>
    <p>Tap any card to view full profile & gallery.</p>
  </section>

  <!-- Grid -->
  <section class="models-gallery">
    <div id="grid" class="models-grid"></div>
  </section>

  <!-- Viewer / overlay -->
  <div id="viewer" class="viewer" aria-hidden="true">
    <div class="viewer-wrap">
      <!-- Left: hero image + thumbs -->
      <div class="stage">
        <img id="heroImg" class="hero-img" alt="" />
        <div id="thumbs" class="thumbs-row"></div>
      </div>

      <!-- Right: floating card -->
      <aside class="floating-card" role="dialog" aria-modal="true" aria-label="Model details">
        <button id="closeBtn" class="close-btn" aria-label="Close">✕</button>

        <div class="header">
          <img id="avatar" class="avatar" alt="">
          <div>
            <div id="cardName" class="title"></div>
            <div id="cardCat" class="subtitle"></div>
          </div>
        </div>

        <div class="facts">
          <div class="fact"><label>Age</label><div id="fAge">—</div></div>
          <div class="fact"><label>Height</label><div id="fHeight">—</div></div>
          <div class="fact"><label>Shoe size</label><div id="fShoe">—</div></div>
          <div class="fact"><label>Shirt size</label><div id="fShirt">—</div></div>
          <div class="fact"><label>Pants size</label><div id="fPants">—</div></div>
          <div class="fact"><label>Category</label><div id="fCat">—</div></div>
        </div>

        <div class="cta">
          <button id="prefillBtn" class="btn">Request Booking</button>
          <button id="shareBtn" class="btn secondary">Share</button>
        </div>

        <form id="bookForm" class="book-form" style="display:none;">
          <div class="field">
            <label for="email">Email</label>
            <input id="email" type="email" placeholder="you@example.com" required>
          </div>
          <div class="field">
            <label for="whatsapp">WhatsApp Number</label>
            <input id="whatsapp" type="tel" placeholder="+27 ..." required>
          </div>
          <button id="sendBtn" type="submit" class="btn">Send Request</button>
          <div id="bookMsg" class="note" style="display:none;"></div>
        </form>
      </aside>
    </div>
  </div>

  <script>
    // -------- API base detection
    const API_BASE = (location.hostname.includes('toasttalent.co.za'))
      ? 'https://api.toasttalent.co.za'
      : (location.hostname.includes('onrender.com'))
      ? 'https://toast-talent-modeling-agency.onrender.com'
      : 'http://localhost:10000';

    // -------- Elements
    const grid = document.getElementById('grid');
    const viewer = document.getElementById('viewer');
    const heroImg = document.getElementById('heroImg');
    const thumbs = document.getElementById('thumbs');
    const closeBtn = document.getElementById('closeBtn');

    const avatar = document.getElementById('avatar');
    const cardName = document.getElementById('cardName');
    const cardCat = document.getElementById('cardCat');

    const fAge = document.getElementById('fAge');
    const fHeight = document.getElementById('fHeight');
    const fShoe = document.getElementById('fShoe');
    const fShirt = document.getElementById('fShirt');
    const fPants = document.getElementById('fPants');
    const fCat = document.getElementById('fCat');

    const prefillBtn = document.getElementById('prefillBtn');
    const shareBtn = document.getElementById('shareBtn');

    const bookForm = document.getElementById('bookForm');
    const bookMsg = document.getElementById('bookMsg');
    const emailEl = document.getElementById('email');
    const waEl = document.getElementById('whatsapp');
    const sendBtn = document.getElementById('sendBtn');

    let MODELS = [];
    let current = null;
    let currentIndex = 0;

    // -------- Load & grid
    async function loadModels() {
      const res = await fetch(`${API_BASE}/api/models`);
      const data = await res.json();
      MODELS = data;

      grid.innerHTML = data.map(m => `
        <div class="model-card" data-id="${m._id}">
          <img src="${m.profilePicture || (m.galleryImages?.[0] || 'images/default.jpg')}" alt="${m.name || ''}">
          <div class="model-name">${(m.name || '')} ${(m.surname || '')}</div>
        </div>
      `).join('');

      grid.querySelectorAll('.model-card').forEach(card => {
        card.addEventListener('click', () => {
          const id = card.getAttribute('data-id');
          const model = MODELS.find(x => x._id === id);
          openViewer(model);
        });
      });
    }

    // -------- Viewer helpers
    function openViewer(m) {
      if (!m) return;
      current = m;
      currentIndex = 0;

      // Header
      avatar.src = m.profilePicture || (m.galleryImages?.[0] || '');
      cardName.textContent = `${m.name || ''} ${m.surname || ''}`.trim();
      cardCat.textContent = (m.category || '—');

      // Facts
      fAge.textContent = m.age || '—';
      fHeight.textContent = m.height ? `${m.height} cm` : '—';
      fShoe.textContent = m.shoe || '—';
      fShirt.textContent = m.shirt || '—';
      fPants.textContent = m.pants || '—';
      fCat.textContent = m.category || '—';

      // Images
      const imgs = [m.profilePicture, ...(m.galleryImages || [])].filter(Boolean);
      thumbs.innerHTML = imgs.map((src, i) => `
        <img src="${src}" alt="thumb ${i}" data-i="${i}">
      `).join('');
      thumbs.querySelectorAll('img').forEach(img => {
        img.addEventListener('click', () => setHero(+img.dataset.i));
      });
      setHero(0);

      // Reset booking UI
      bookForm.style.display = 'none';
      bookMsg.style.display = 'none';
      emailEl.value = ''; waEl.value = '';

      viewer.classList.add('open');
      viewer.setAttribute('aria-hidden', 'false');
    }

    function setHero(i) {
      currentIndex = i;
      const imgs = [current.profilePicture, ...(current.galleryImages || [])].filter(Boolean);
      heroImg.src = imgs[i] || '';
      thumbs.querySelectorAll('img').forEach((el, idx) => {
        el.classList.toggle('is-active', idx === i);
      });
    }

    // Close overlay
    closeBtn.addEventListener('click', () => {
      viewer.classList.remove('open');
      viewer.setAttribute('aria-hidden', 'true');
    });
    viewer.addEventListener('click', (e) => {
      // click outside the card/stage closes
      const wrap = e.target.closest('.viewer-wrap');
      if (!wrap) {
        viewer.classList.remove('open');
        viewer.setAttribute('aria-hidden', 'true');
      }
    });

    // Share
    shareBtn.addEventListener('click', async () => {
      try {
        const url = `${location.origin}/models.html#${current?._id || ''}`;
        if (navigator.share) {
          await navigator.share({ title: document.title, url });
        } else {
          await navigator.clipboard.writeText(url);
          shareBtn.textContent = 'Copied!';
          setTimeout(() => shareBtn.textContent = 'Share', 1200);
        }
      } catch {}
    });

    // Show booking form
    prefillBtn.addEventListener('click', () => {
      bookForm.style.display = (bookForm.style.display === 'none') ? 'grid' : 'none';
      bookMsg.style.display = 'none';
    });

    // Booking submit -> /api/book
    bookForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      sendBtn.disabled = true;

      try {
        const payload = {
          modelId: current?._id,
          modelName: `${current?.name || ''} ${current?.surname || ''}`.trim(),
          requesterEmail: emailEl.value.trim(),
          requesterWhatsapp: waEl.value.trim()
        };

        const res = await fetch(`${API_BASE}/api/book`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          const t = await res.text().catch(()=> '');
          throw new Error(`Booking failed: ${res.status} ${t}`);
        }
        bookMsg.textContent = '✅ Thank you! Your booking request has been sent.';
        bookMsg.style.display = 'block';
        bookForm.reset();
      } catch (err) {
        bookMsg.textContent = '❌ ' + (err?.message || 'Failed to send request.');
        bookMsg.style.display = 'block';
      } finally {
        sendBtn.disabled = false;
      }
    });

    // Init
    loadModels();
  </script>
</body>
</html>
