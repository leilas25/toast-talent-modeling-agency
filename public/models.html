<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Models — Toast Talent</title>
  <style>
    :root {
      --bg:#fafafa; --text:#111; --muted:#666; --card:#fff; --line:#eee; --acc:#111;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family: Inter, system-ui, -apple-system, Arial, sans-serif;background:var(--bg);color:var(--text)}
    /* Top bar / site nav (same feel as other pages) */
    .topbar{background:var(--acc);color:#fff}
    .topbar-inner{max-width:1100px;margin:0 auto;padding:14px 18px;display:flex;align-items:center;gap:16px}
    .logo{display:flex;align-items:center;gap:10px;text-decoration:none;color:#fff;font-weight:700}
    .logo img{width:36px;height:36px;object-fit:cover;border-radius:6px}
    .links{margin-left:auto;display:flex;gap:16px}
    .links a{color:#fff;text-decoration:none;opacity:.9}
    .links a:hover{opacity:1}

    /* Category tabs */
    .tabs{position:sticky;top:0;z-index:5;background:#fff;border-bottom:1px solid var(--line)}
    .tabs-inner{max-width:1100px;margin:0 auto;display:flex;gap:4px;padding:10px 8px}
    .tab{appearance:none;border:none;background:none;padding:12px 16px;border-radius:8px;cursor:pointer;font-weight:600;color:#333}
    .tab:hover{background:#f2f2f2}
    .tab.active{background:#111;color:#fff}

    /* Grid */
    .wrap{max-width:1100px;margin:0 auto;padding:20px 16px 60px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(190px,1fr));gap:18px}
    .card{background:var(--card);border-radius:12px;overflow:hidden;box-shadow:0 2px 10px rgba(0,0,0,.06);cursor:pointer;transition:transform .15s}
    .card:hover{transform:translateY(-3px)}
    .card img{width:100%;height:240px;object-fit:cover;background:#ddd}
    .card .meta{padding:10px 12px}
    .card h3{margin:0 0 4px;font-size:15px}
    .chip{display:inline-block;padding:2px 8px;background:#f3f3f3;border-radius:999px;font-size:12px;color:#444;margin-right:6px}

    /* Modal */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.65);display:none;align-items:center;justify-content:center;padding:14px;z-index:20}
    .modal.show{display:flex}
    .sheet{width:100%;max-width:1100px;background:#fff;border-radius:16px;overflow:hidden;display:grid;grid-template-columns:1.2fr .9fr;min-height:70vh}
    @media (max-width:900px){.sheet{grid-template-columns:1fr}}
    .gallery{position:relative;background:#000;display:flex;align-items:center;justify-content:center}
    .gallery img{max-width:100%;max-height:70vh;object-fit:contain;background:#000}
    .thumbs{position:absolute;left:0;right:0;bottom:8px;display:flex;gap:6px;justify-content:center;padding:0 12px}
    .thumbs img{width:64px;height:64px;object-fit:cover;border:2px solid transparent;border-radius:6px;cursor:pointer;opacity:.9}
    .thumbs img.active{border-color:#fff;opacity:1}
    .navbtn{position:absolute;top:50%;transform:translateY(-50%);background:rgba(255,255,255,.9);border:none;border-radius:999px;width:40px;height:40px;cursor:pointer;font-size:18px}
    .navbtn:hover{background:#fff}
    .navbtn.prev{left:10px}
    .navbtn.next{right:10px}

    .side{padding:20px 22px;display:flex;flex-direction:column;gap:14px}
    .side h2{margin:0;font-size:22px}
    .profile-row{display:flex;align-items:center;gap:12px}
    .pfp{width:60px;height:60px;border-radius:10px;object-fit:cover;background:#ddd}
    .rows{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .row{background:#fafafa;border:1px solid var(--line);border-radius:10px;padding:10px 12px}
    .row b{display:block;font-size:12px;color:#666;margin-bottom:4px}
    .row span{font-size:14px}
    .actions{display:flex;gap:10px;margin-top:4px}
    .btn{appearance:none;border:none;border-radius:10px;padding:12px 14px;font-weight:600;cursor:pointer}
    .btn.primary{background:#111;color:#fff}
    .btn.light{background:#f3f3f3;color:#111}

    .book{margin-top:4px;border-top:1px dashed var(--line);padding-top:12px;display:none}
    .book.show{display:block}
    .book label{display:block;font-size:12px;color:#666;margin:6px 0 4px}
    .book input{width:100%;padding:10px;border:1px solid var(--line);border-radius:8px;font-size:14px}
    .note{font-size:12px;color:#666}

    .closeX{position:absolute;top:10px;right:12px;background:rgba(255,255,255,.95);border:none;border-radius:999px;width:36px;height:36px;cursor:pointer;font-size:18px}
  </style>
</head>
<body>
  <!-- Topbar -->
  <div class="topbar">
    <div class="topbar-inner">
      <a class="logo" href="index.html">
        <img src="images/Toast Logo.jpeg" alt="Toast Talent Logo">
        <span>Toast Talent</span>
      </a>
      <nav class="links">
        <a href="index.html">Home</a>
        <a href="models.html" aria-current="page" style="text-decoration:underline">Models</a>
        <a href="about.html">About</a>
        <a href="contact.html">Contact</a>
        <a href="apply.html">Apply</a>
      </nav>
    </div>
  </div>

  <!-- Category tabs -->
  <div class="tabs">
    <div class="tabs-inner">
      <button class="tab active" data-cat="Women">Women</button>
      <button class="tab" data-cat="Men">Men</button>
      <button class="tab" data-cat="Kids">Kids</button>
    </div>
  </div>

  <div class="wrap">
    <div id="grid" class="grid"></div>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="sheet">
      <div class="gallery">
        <button class="closeX" id="closeX" aria-label="Close">✕</button>
        <button class="navbtn prev" id="prev">‹</button>
        <img id="hero" alt="Model image" />
        <button class="navbtn next" id="next">›</button>
        <div class="thumbs" id="thumbs"></div>
      </div>
      <div class="side">
        <div class="profile-row">
          <img id="pfp" class="pfp" alt="">
          <div>
            <h2 id="fullname">—</h2>
            <div class="note" id="catBadge">—</div>
          </div>
        </div>
        <div class="rows">
          <div class="row"><b>Age</b><span id="age">—</span></div>
          <div class="row"><b>Height</b><span id="height">—</span></div>
          <div class="row"><b>Shoe</b><span id="shoe">—</span></div>
          <div class="row"><b>Shirt</b><span id="shirt">—</span></div>
          <div class="row"><b>Pants</b><span id="pants">—</span></div>
        </div>
        <div class="actions">
          <button class="btn primary" id="bookBtn">Book this model</button>
          <button class="btn light" id="shareBtn">Share</button>
        </div>

        <!-- Booking inline form -->
        <div id="bookBox" class="book">
          <label>Your email</label>
          <input id="reqEmail" type="email" placeholder="you@example.com" />
          <label>Your WhatsApp number</label>
          <input id="reqWhats" type="tel" placeholder="+27 ..." />
          <div class="actions" style="margin-top:10px">
            <button class="btn primary" id="sendBook">Send booking request</button>
            <button class="btn light" id="cancelBook" type="button">Cancel</button>
          </div>
          <div class="note" id="bookMsg"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // -------- API base detection --------
    const API_BASE = (location.hostname.includes('toasttalent.co.za'))
      ? 'https://api.toasttalent.co.za'
      : (location.hostname.includes('onrender.com'))
      ? 'https://toast-talent-modeling-agency.onrender.com'
      : 'http://localhost:10000';

    // -------- UI refs --------
    const grid = document.getElementById('grid');
    const tabs = document.querySelectorAll('.tab');
    const modal = document.getElementById('modal');
    const hero = document.getElementById('hero');
    const thumbs = document.getElementById('thumbs');
    const pfp = document.getElementById('pfp');
    const fullname = document.getElementById('fullname');
    const catBadge = document.getElementById('catBadge');
    const ageEl = document.getElementById('age');
    const heightEl = document.getElementById('height');
    const shoeEl = document.getElementById('shoe');
    const shirtEl = document.getElementById('shirt');
    const pantsEl = document.getElementById('pants');
    const closeX = document.getElementById('closeX');
    const prev = document.getElementById('prev');
    const next = document.getElementById('next');
    const bookBtn = document.getElementById('bookBtn');
    const shareBtn = document.getElementById('shareBtn');
    const bookBox = document.getElementById('bookBox');
    const reqEmail = document.getElementById('reqEmail');
    const reqWhats = document.getElementById('reqWhats');
    const sendBook = document.getElementById('sendBook');
    const cancelBook = document.getElementById('cancelBook');
    const bookMsg = document.getElementById('bookMsg');

    let allModels = [];
    let current = null; // { model, index, currentImgIdx }

    tabs.forEach(t => {
      t.addEventListener('click', () => {
        tabs.forEach(x => x.classList.remove('active'));
        t.classList.add('active');
        renderGrid(t.dataset.cat);
      });
    });

    async function fetchModels() {
      const res = await fetch(`${API_BASE}/api/models`);
      allModels = await res.json();
    }

    function renderGrid(category) {
      const items = allModels.filter(m => (m.category || 'Women') === category);
      if (!items.length) {
        grid.innerHTML = `<p style="color:#666;text-align:center;width:100%">No ${category} yet.</p>`;
        return;
      }
      grid.innerHTML = items.map(m => `
        <div class="card" data-id="${m._id}">
          <img src="${m.profilePicture || ''}" alt="${(m.name||'')}" loading="lazy">
          <div class="meta">
            <h3>${m.name || ''} ${m.surname || ''}</h3>
            <span class="chip">${m.height ? (m.height + ' cm') : ''}</span>
            <span class="chip">${m.age ? ('Age ' + m.age) : ''}</span>
          </div>
        </div>
      `).join('');

      grid.querySelectorAll('.card').forEach(el => {
        el.addEventListener('click', () => {
          const id = el.getAttribute('data-id');
          const model = allModels.find(x => x._id === id);
          openModal(model);
        });
      });
    }

    function openModal(model) {
      current = { model, currentImgIdx: 0 };
      pfp.src = model.profilePicture || '';
      fullname.textContent = `${model.name || ''} ${model.surname || ''}`.trim();
      catBadge.textContent = model.category || '';
      ageEl.textContent = model.age || '—';
      heightEl.textContent = model.height ? `${model.height} cm` : '—';
      shoeEl.textContent = model.shoe || '—';
      shirtEl.textContent = model.shirt || '—';
      pantsEl.textContent = model.pants || '—';

      const imgs = [model.profilePicture, ...(model.galleryImages || [])].filter(Boolean);
      if (!imgs.length) imgs.push(''); // fallback
      setHero(imgs[0]);

      thumbs.innerHTML = imgs.map((src, i) =>
        `<img src="${src}" data-i="${i}" class="${i===0?'active':''}" alt="thumb">`
      ).join('');
      thumbs.querySelectorAll('img').forEach(img => {
        img.addEventListener('click', () => {
          const idx = Number(img.dataset.i);
          current.currentImgIdx = idx;
          setHero(imgs[idx]);
          thumbs.querySelectorAll('img').forEach(t => t.classList.remove('active'));
          img.classList.add('active');
        });
      });

      // reset booking box
      bookBox.classList.remove('show');
      bookMsg.textContent = '';
      reqEmail.value = ''; reqWhats.value = '';

      modal.classList.add('show');
      modal.setAttribute('aria-hidden','false');

      prev.onclick = () => stepImage(-1);
      next.onclick = () => stepImage(1);
    }

    function setHero(src){ hero.src = src; }

    function stepImage(delta){
      const imgs = [current.model.profilePicture, ...(current.model.galleryImages||[])].filter(Boolean);
      current.currentImgIdx = (current.currentImgIdx + delta + imgs.length) % imgs.length;
      setHero(imgs[current.currentImgIdx]);
      thumbs.querySelectorAll('img').forEach((t,i)=>t.classList.toggle('active', i===current.currentImgIdx));
    }

    function closeModal(){
      modal.classList.remove('show');
      modal.setAttribute('aria-hidden','true');
      current = null;
    }

    closeX.addEventListener('click', closeModal);
    modal.addEventListener('click', (e)=>{ if(e.target===modal) closeModal(); });

    // Share (optional)
    shareBtn.addEventListener('click', async () => {
      if (!current) return;
      const m = current.model;
      const url = location.origin + location.pathname + `?model=${encodeURIComponent(m._id)}`;
      try {
        await navigator.clipboard.writeText(url);
        alert('Link copied to clipboard');
      } catch { alert('Link: ' + url); }
    });

    // Booking
    bookBtn.addEventListener('click', () => {
      bookBox.classList.toggle('show');
      bookMsg.textContent = '';
    });
    cancelBook.addEventListener('click', () => {
      bookBox.classList.remove('show');
      bookMsg.textContent = '';
    });
    sendBook.addEventListener('click', async () => {
      if (!current) return;
      const email = reqEmail.value.trim();
      const wa = reqWhats.value.trim();
      if (!email || !wa) {
        bookMsg.textContent = 'Please enter your email and WhatsApp number.'; return;
      }
      bookMsg.textContent = 'Sending...';
      try {
        const payload = {
          modelId: current.model._id,
          modelName: `${current.model.name||''} ${current.model.surname||''}`.trim(),
          requesterEmail: email,
          requesterWhatsapp: wa
        };
        const res = await fetch(`${API_BASE}/api/book`, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        if (!res.ok) throw new Error(await res.text());
        bookMsg.textContent = 'Booked! We will contact you shortly.';
      } catch (err) {
        bookMsg.textContent = 'Failed to send booking. Please try again.';
        console.error(err);
      }
    });

    // Init
    (async function init(){
      await fetchModels();
      renderGrid('Women');

      // If shared deep-link with ?model=ID, open it
      const params = new URLSearchParams(location.search);
      const pre = params.get('model');
      if (pre) {
        const m = allModels.find(x => x._id === pre);
        if (m) openModal(m);
      }
    })();
  </script>
</body>
</html>
