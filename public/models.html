<script>
const apiBaseUrl = "https://toast-talent-modeling-agency-ltbd-i6iz4yj5e.vercel.app"; // ✅ Your Vercel domain

function loadModels() {
  fetch(`${apiBaseUrl}/api/models`)
    .then(res => res.json())
    .then(models => {
      const grid = document.getElementById('modelsGrid');
      grid.innerHTML = models.map(model => `
        <div class="model-card" data-model-id="${model._id}">
          <img src="${model.profilePicture || 'images/default.jpg'}" alt="${model.name}" onerror="this.src='images/default.jpg'">
          <div class="model-name">${model.name}</div>
        </div>`).join('');

      document.querySelectorAll('.model-card').forEach(card => {
        card.addEventListener('click', () => {
          const modelId = card.getAttribute('data-model-id');
          loadModelDetails(modelId);
        });
      });
    })
    .catch(err => {
      console.error('Error loading models:', err);
      document.getElementById('modelsGrid').innerHTML = "<p style='color:red;text-align:center;'>Couldn’t load models.</p>";
    });
}

function loadModelDetails(modelId) {
  fetch(`${apiBaseUrl}/api/models/${modelId}`)
    .then(res => res.json())
    .then(model => {
      let imagesHtml = '';
      if (model.galleryImages?.length) {
        imagesHtml = '<div class="modal-model-images">' +
          model.galleryImages.map(img => `<img src="${img}" alt="${model.name}" onerror="this.src='images/default.jpg'">`).join('') +
          '</div>';
      }

      document.getElementById('modalModelInfo').innerHTML = `
        ${imagesHtml}
        <h2>${model.name}</h2>
        <div>Age: ${model.age || '-'}</div>
        <div>Shoe Size: ${model.shoe || '-'}</div>
        <div>Shirt Size: ${model.shirt || '-'}</div>
        <div>Pants Size: ${model.pants || '-'}</div>
        <div>Height: ${model.height || '-'}</div>
      `;
      document.getElementById('modelModal').style.display = 'flex';
      attachModalImageHandlers();
    })
    .catch(() => {
      document.getElementById('modalModelInfo').innerHTML = "<p>Error loading model details.</p>";
      document.getElementById('modelModal').style.display = 'flex';
    });
}

function attachModalImageHandlers() {
  const lightbox = document.getElementById('modalLightbox');
  const lightboxImg = lightbox.querySelector('.lightbox-img');
  const closeLightboxBtn = lightbox.querySelector('.close-lightbox');

  document.querySelectorAll('#modelModalContent .modal-model-images img').forEach(img => {
    img.addEventListener('click', () => {
      lightboxImg.src = img.src;
      lightbox.classList.add('show');
    });
  });

  closeLightboxBtn.onclick = () => {
    lightbox.classList.remove('show');
    lightboxImg.src = '';
  };
}

document.getElementById('closeModalBtn').addEventListener('click', () => {
  document.getElementById('modelModal').style.display = 'none';
});

loadModels();
</script>
